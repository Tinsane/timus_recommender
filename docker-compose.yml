version: '3.6'

services:
  lock:
    build:
      context: .
      dockerfile: docker/Dockerfile.lock
      network: host
    volumes:
      - .:/output

  bot:
    image: "ashibaevid/timus-recommender:${TAG:-latest}"
    build:
      context: .
      dockerfile: docker/Dockerfile.code
      cache_from:
        - "ashibaevid/timus-recommender:${TAG:-latest}"
    environment:
      - TIMUS_RECOMMENDER_BOT_TOKEN=${TIMUS_RECOMMENDER_BOT_TOKEN:-unset}
      - DB_URL=${DB_URL}
    command:
      - python3
      - bot_main.py